(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-071e","chunk-06e0"],{"/kTF":function(t,e,r){"use strict";var i=r("BuF4");r.n(i).a},BuF4:function(t,e,r){},OYHo:function(t,e,r){},"Qpg+":function(t,e,r){"use strict";r.r(e);var i=r("m1cH"),a=r.n(i),n=r("gDS+"),o=r.n(n),s=r("y2a5"),l=r("U+t5"),c={name:"orgtreetable",mixins:[s.a],components:{Orgedit:l.default},data:function(){return{orgstatus:[{label:"正常",val:"f"},{label:"停用",val:"t"}],orgQueryInit:[{name:"title",val:"",op:"like"},{name:"type",val:"部门",op:"="},{name:"stop",val:"f",op:"like"}],orgQueryArr:[{name:"title",val:"",op:"like"},{name:"type",val:"部门",op:"=",tb:"org"},{name:"stop",val:"f",op:"like",tb:"org"}],orgSortParas:[{name:"title",orderV:"asc",tb:"org"}],orgTtData:[],showEditOrgSet:!1,actAdd:!1,orgInstEdit:null,orgDepartDatas:[]}},mounted:function(){this.getDepartDatas()},methods:{searchOrg:function(){this.orgTtData=[],this.getOrgTtData(0)},delOrg:function(){var t=this,e=this.$refs.org.getCheckedKeys();console.log("checkedArr:",e),!e||e.length<1||0!=e[0]&&this.$confirm("确认删除？此部门下的子部门将会一并删除","删除部门",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r=t.getChildId(e);if(r&&r.length>0){console.log("delIds 2",r);var i={_hy:"orgdel",org:[{name:"id",val:r,op:"in"}]};t.callSrvAct("/act",i).then(function(e){t.rmObjFromTreeData(t.orgTtData,r);for(var i=t.orgDepartDatas.length-1;i>-1;i--)r.indexOf(t.orgDepartDatas[i].id)>-1&&t.orgDepartDatas.splice(i,1);t.$nextTick(function(){t.$set(t,"orgTtData",JSON.parse(o()(t.orgTtData)))})})}}).catch(function(t){})},getChildId:function(t){for(var e=JSON.parse(o()(t)),r=!0;r;){r=!1;for(var i=0;i<this.orgDepartDatas.length;i++)console.log("i:",i,e.indexOf(this.orgDepartDatas[i].parent_id)),e.indexOf(this.orgDepartDatas[i].id)<0&&e.indexOf(this.orgDepartDatas[i].parent_id)>-1&&(e.push(this.orgDepartDatas[i].id),r=!0)}return e},delOrgs:function(){var t=this,e=this.$refs.org.getCheckedKeys();!e||e.length<1||this.$confirm("确认删除？此部门下的子部门将会一并删除","删除部门",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r=t.getChildId(e);if(r&&r.length>0){console.log("delIds 3",r);var i={_hy:"orgdel",org:[{name:"id",val:r,op:"in"}]};t.callSrvAct("/act",i).then(function(e){t.rmObjFromTreeData(t.orgTtData,r);for(var i=t.orgDepartDatas.length-1;i>-1;i--)r.indexOf(t.orgDepartDatas[i].id)>-1&&t.orgDepartDatas.splice(i,1);t.$nextTick(function(){t.$set(t,"orgTtData",JSON.parse(o()(t.orgTtData)))})})}}).catch(function(t){})},setObjInParentArr:function(t,e){var r=!1;if(t){for(var i=0;i<t.length;i++)if(t[i].title>e.title){var a=t[i];t.splice(i,1,e,a),r=!0;break}r||t.push(e)}},rmObjFromTreeData:function(t,e){if(t&&!(t.length<1)&&e){for(var r=t.length-1;r>-1;r--)console.log("i:",t[r],e.indexOf(t[r].id)),e.indexOf(t[r].id)>-1&&(console.log("rm arr,i",t,r),t.splice(r,1));for(var i=0;i<t.length;i++)t[i].children&&t[i].children.length>0&&this.rmObjFromTreeData(t[i].children,e)}},rmObjFromParentArr:function(t,e){if(t&&!(t.length<1)&&e)for(var r=0;r<t.length;r++)if(t[r].id==e.id)return void t.splice(r,1)},setOrgItem:function(t,e){var r=this.findOrgItem(t,e.id);if(r)if(r.parent_id>0){var i=this.findOrgItem(this.orgTtData,r.parent_id);i&&(this.rmObjFromParentArr(i.children,r),i.hy_extra_num=i.children.length+1,i.isLeaf=i.hy_extra_num<2)}else this.rmObjFromParentArr(this.orgTtData,r);if(e.parent_id<1)this.setObjInParentArr(this.orgTtData,e);else{var a=this.findOrgItem(this.orgTtData,e.parent_id);a&&(a.children||(a.children=[]),this.setObjInParentArr(a.children,e),a.hy_extra_num=a.children.length+1,a.isLeaf=a.hy_extra_num<2)}},editOrgSetOK:function(t,e){t.children||(t.children=[]),t.hy_extra_num||(t.hy_extra_num=t.children.length+1),this.actAdd&&this.orgDepartDatas.push(t),this.setOrgItem(this.orgTtData,t),this.orgInstEdit={},this.showEditOrgSet=!1},editOrgSet:function(){var t=this.$refs.org.getCheckedKeys();if(t&&!(t.length<1)){var e=this.findOrgItem(this.orgTtData,t[0]);e&&(this.orgInstEdit=JSON.parse(o()(e)),this.actAdd=!1,this.showEditOrgSet=!0)}},addNewOrg:function(){var t=this.$refs.org.getCheckedKeys();!t||t.length<1?this.orgInstEdit={id:0,title:"",type:"部门",parent_id:0,sort:0,data_scope:"f",stop:"f",memo:""}:this.orgInstEdit={id:0,title:"",type:"部门",parent_id:t[0],sort:0,data_scope:"f",stop:"f",memo:""},this.actAdd=!0,this.showEditOrgSet=!0},orgTreeCheck:function(t,e){if(console.log("data:",t),t.hy_extra_num>1&&(!t.children||t.children.length<1)){var r=this.$refs.org.getNode(t.id);r&&this.getOrgTtData(t.id,r)}},clickTreeItem:function(t,e){if(console.log("node:",t),t.hy_extra_num>1&&(!t.children||t.children.length<1))this.getOrgTtData(t.id,e),t.expanded=!t.expanded;else{if(t.id<1)return;var r=this.$refs.org.getCheckedKeys();r&&r.indexOf(t.id)>-1?this.$refs.org.setChecked(t.id,!1,!1):this.$refs.org.setChecked(t.id,!0,!1),t.expanded=!t.expanded}},findOrgItem:function(t,e){if(!t||t.length<1)return null;for(var r=0;r<t.length;r++)if(console.log("arr,",r,t[r].id,e,t[r].id==e),t[r].id==e)return t[r];for(var i=0;i<t.length;i++)if(t[i].children&&t[i].children.length>0){var a=this.findOrgItem(t[i].children,e);if(a)return a}return null},appendData:function(t,e){if(t<1){var r;e&&e.length>0&&(r=this.orgTtData).push.apply(r,a()(e))}else{var i=this.findOrgItem(this.orgTtData,t);console.log("parentItem:",i,t),i&&(i.children=e||[],i.hy_extra_num=i.children.length+1,i.isLeaf=i.hy_extra_num<2),console.log("parentItem:",i,t,this.orgTtData)}},getDepartDatas:function(){var t=this,e={_hy:"departlist",qps:[{name:"type",val:"部门",op:"=",tb:"org"},{name:"stop",val:"f",op:"like",tb:"org"}],sps:this.orgSortParas};this.callSrvAct("/actq",e).then(function(e){console.log("res:",e),t.orgDepartDatas=e.data||[],t.getOrgTtData(0)})},queryDepartById2:function(t,e){for(var r=[],i=0;i<this.orgDepartDatas.length;i++)this.orgDepartDatas[i].parent_id==t&&this.orgDepartDatas[i].title.indexOf(e)>-1&&r.push(this.orgDepartDatas[i]);return r},queryDepartById:function(t,e){for(var r=[],i=0;i<this.orgDepartDatas.length;i++)console.log("testddd:",this.orgDepartDatas[i].parent_id==t),this.orgDepartDatas[i].parent_id==t&&this.orgDepartDatas[i].title.indexOf(e)>-1&&r.push(this.orgDepartDatas[i]);console.log("queryData:",r);for(var a=0;a<r.length;a++){var n=this.queryDepartById2(r[a].id,e);console.log("retArr2:",n),r[a].hy_extra_num=n?n.length+1:1,r[a].children||(r[a].children=[])}return console.log("queryData 2:",r),r},getOrgTtData:function(t,e){for(var r=this,i=(JSON.parse(o()(this.orgQueryArr)),this.queryDepartById(t,this.orgQueryArr[0].val)),a=0;a<i.length;a++)i[a].isLeaf=i[a].hy_extra_num<2,i[a].children||(i[a].children=[]);console.log("retData:",i,t,e),this.appendData(t,i),e&&this.$nextTick(function(){console.log("this.node:",e),e.expanded=!0,r.$set(r,"orgTtData",JSON.parse(o()(r.orgTtData))),console.log("refressh....")})}}},d=(r("/kTF"),r("KHd+")),h=Object(d.a)(c,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-container",{attrs:{direction:"vertical"}},[r("el-container",{staticStyle:{height:"40px"},attrs:{direction:"horizontal"}},[r("el-input",{staticStyle:{"margin-right":"10px",width:"250px"},attrs:{placeholder:"部门名称"},model:{value:t.orgQueryArr[0].val,callback:function(e){t.$set(t.orgQueryArr[0],"val",e)},expression:"orgQueryArr[0].val"}}),t._v(" "),r("el-button",{on:{click:t.searchOrg}},[r("span",[t._v("搜索\n            ")])]),t._v(" "),r("el-button",{on:{click:t.addNewOrg}},[r("span",[t._v("新增\n            ")])]),t._v(" "),r("el-button",{on:{click:t.editOrgSet}},[r("span",[t._v("修改\n            ")])]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.delOrg}},[r("span",[t._v("删除\n            ")])]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.delOrgs}},[r("span",[t._v("批量删除\n            ")])])],1),t._v(" "),r("el-main",{staticStyle:{margin:"0px",padding:"0px"}},[r("el-tree",{ref:"org",staticStyle:{"font-size":"16px","margin-top":"10px"},attrs:{"node-key":"id",props:{label:"title",disabled:!1,isLeaf:!0,children:"children"},"highlight-current":!0,"default-expand-all":!0,"show-checkbox":!0,"check-strictly":!0,data:t.orgTtData},on:{"node-click":t.clickTreeItem,check:t.orgTreeCheck}})],1),t._v(" "),r("el-dialog",{attrs:{visible:t.showEditOrgSet,title:"部门编辑","append-to-body":!0,"destroy-on-close":!0},on:{"update:visible":function(e){t.showEditOrgSet=e}}},[r("orgedit",{attrs:{paramsObj:t.orgInstEdit},on:{submitOk:t.editOrgSetOK,submitClose:function(e){t.showEditOrgSet=!1}}})],1)],1)},[],!1,null,"3c26b487",null);h.options.__file="index.vue";e.default=h.exports},"RU/L":function(t,e,r){r("Rqdy");var i=r("WEpk").Object;t.exports=function(t,e,r){return i.defineProperty(t,e,r)}},Rqdy:function(t,e,r){var i=r("Y7ZC");i(i.S+i.F*!r("jmDH"),"Object",{defineProperty:r("2faE").f})},SEkw:function(t,e,r){t.exports={default:r("RU/L"),__esModule:!0}},"U+t5":function(t,e,r){"use strict";r.r(e);var i=r("P2sY"),a=r.n(i),n=r("YEIV"),o=r.n(n),s={name:"orgedit",mixins:[r("y2a5").a],components:{},props:{paramsObj:{type:Object,default:function(){return{}}}},data:function(){var t;return t={newOrgForm:{id:0,title:"",type:"",parent_id:0,sort:0,data_scope:"",stop:"",memo:""},orgForm:{},orgData:[]},o()(t,"newOrgForm",{id:0,title:"",type:"部门",parent_id:0,sort:0,data_scope:"f",stop:"f",memo:""}),o()(t,"isInDialog",!1),o()(t,"pObj",{}),t},mounted:function(){console.log(" xxxxxx ------ "),this.pObj=a()({},this.paramsObj),this.gcomm.mapLength(this.pObj)>0?(this.isInDialog=!0,this.orgForm=a()({},this.newOrgForm,this.pObj)):this.orgForm=a()({},this.newOrgForm,this.$route.params)},methods:{pObjChanged:function(){this.gcomm.mapLength(this.pObj)>0&&(this.isInDialog=!0,this.orgForm=a()({},this.newOrgForm,this.pObj))},changedc6d8:function(t){for(var e=0;e<this.orgData.length;e++)this.orgData[e].id==this.orgForm.parent_id&&(this.orgForm.parent_title=this.orgData[e].title)},clickf5e8c:function(){this.submitOrgForm("orgForm")},handleClose:function(){this.isInDialog?this.$emit("submitClose"):this.$router.go(-1)},submitOrgFormImpl:function(t){var e=this,r=void 0,i=!0,n="";this[t].id>0?(r="/act",i=!1,n="deptup"):(r="/act",n="deptadd");var o=a()({},this[t]);o._hy=n,this.callSrvAct(r,o).then(function(t){console.log("res:",t,e.isInDialog),e.isInDialog?i?t.data&&t.data.inst?e.$emit("submitOk",t.data.inst):t.data&&e.$emit("submitOk",t.data||{}):e.$emit("submitOk",o):e.$router.go(-1)})},submitOrgForm:function(t){var e=this;this.$refs[t].validate(function(r){if(!r)return!1;e.submitOrgFormImpl(t)})}},watch:{paramsObj:function(t){this.pObj.id!=this.paramsObj.id&&(this.pObj=a()({},this.paramsObj),this.pObjChanged())}},computed:{},beforeCreate:function(){},created:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){}},l=(r("eLV9"),r("KHd+")),c=Object(l.a)(s,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-container",{attrs:{direction:"vertical"}},[r("el-form",{ref:"orgForm",staticStyle:{padding:"10px"},attrs:{model:t.orgForm,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"部门名称",prop:"title",rules:{required:!0,message:"请输入正确的部门名称",trigger:"blur",min:1,max:200}}},[r("el-input",{model:{value:t.orgForm.title,callback:function(e){t.$set(t.orgForm,"title",e)},expression:"orgForm.title"}})],1),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),r("el-row",{attrs:{type:"flex",justify:"center"}},[r("el-button",{on:{click:t.clickf5e8c}},[r("span",[t._v("确定\n                    ")])]),t._v(" "),r("el-button",{on:{click:t.handleClose}},[r("span",[t._v("取消\n                    ")])])],1)],1)],1)},[],!1,null,"a9318a8e",null);c.options.__file="index.vue";e.default=c.exports},YEIV:function(t,e,r){"use strict";e.__esModule=!0;var i=function(t){return t&&t.__esModule?t:{default:t}}(r("SEkw"));e.default=function(t,e,r){return e in t?(0,i.default)(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},eLV9:function(t,e,r){"use strict";var i=r("OYHo");r.n(i).a}}]);