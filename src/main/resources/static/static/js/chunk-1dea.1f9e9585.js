(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1dea"],{CXAN:function(t,e,a){"use strict";var l=a("nvJI");a.n(l).a},IB8E:function(t,e,a){"use strict";a.r(e);var l={name:"rmanagement",mixins:[a("y2a5").a],components:{},props:{},data:function(){return{policyData:[],policyTotalRec:0,policyTotalPage:0,policyRecOfPage:10,policyCurPage:1,policyCbPage:this.gen_list_cb("policy"),policyQueryArr:[],policyQueryInit:[],tableHeight:window.innerHeight-500,selectData:[],org_id:"",gateway_title:"",cardnumber:"",idnumber:"",user_title:"",txTime:[],tsSelLabel:"",deptShowVal:"",tsData:[],deptProps:{label:"title",isLeaf:"isLeaf",children:"children"},showLoading:!1}},mounted:function(){var t=this;this.callSrvAct("/actq",{_hy:"departlist",qps:[{name:"type",val:"部门",tb:"org"}],sps:[{name:"title",tb:"org",orderV:"asc"}]}).then(function(e){for(var a=e.data||[],l=0;l<a.length;l++)t.fillDepatData(t.tsData,a[l])}),this.callSrvAct("/policylist",{user_title:"",cp:this.policyCurPage,rop:this.policyRecOfPage}).then(function(e){t.policyData=e.data.pageData||[],t.policyTotalRec=e.data.totalRec,t.policyCurPage=e.data.cp,t.policyRecOfPage=e.data.rop})},methods:{filterDepart:function(t){t!=this.tsSelLabel&&this.$refs.depttreein.filter(t)},testScrollHeight:function(){this.$nextTick(function(){var t=document.querySelectorAll(".el-scrollbar .el-select-dropdown__wrap")[0],e=document.querySelectorAll(".el-scrollbar .el-scrollbar__bar");t.style.cssText="margin:0px;max-height:500px;overflow:auto;",e.forEach(function(t){return t.style.width=0})})},fillDepatData:function(t,e){if(!e)return!0;if(e.parent_id<1)return e.children=[],e.isLeaf=!0,t.push(e),!0;for(var a=0;a<t.length;a++)if(t[a].id==e.parent_id)return e.children=[],e.isLeaf=!0,t[a].children.push(e),t[a].isLeaf=!1,!0;for(var l=0;l<t.length;l++){if(t[l].children.length>0)if(this.fillDepatData(t[l].children,e))return!0}return!1},handleDeptNodeClick:function(t,e,a){console.log("data:",t),this.tsSelLabel=t.title,this.deptShowVal=t.title,this.org_id=t.id||0,this.$refs.depttree.blur()},filterDeptNode:function(t,e){return!t||-1!==e.title.indexOf(t)},search:function(){var t=this;this.callSrvAct("/policylist",{user_title:this.user_title,org_id:this.org_id,starttime:this.txTime[0],endtime:this.txTime[1],gateway_title:this.gateway_title,cardnumber:this.cardnumber,idnumber:this.idnumber,cp:1,rop:this.policyRecOfPage}).then(function(e){console.log("返回值",e),t.policyData=e.data.pageData||[],t.policyTotalRec=e.data.totalRec,t.policyCurPage=e.data.cp,t.policyRecOfPage=e.data.rop})},dis:function(){this.$router.push({name:"aassig",params:null})},timess:function(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"  "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},handleChange:function(t){this.selectData=t},del:function(t,e){var a=this;this.showLoading=!0,this.apiSrv.callServer("/policydel",[e.id]).then(function(t){a.showLoading=!1,a.callSrvAct("/policylist",{user_title:"",cp:a.policyCurPage,rop:a.policyRecOfPage}).then(function(t){console.log("返回值",t),a.policyData=t.data.pageData||[],a.policyTotalRec=t.data.totalRec,a.policyCurPage=t.data.cp,a.policyRecOfPage=t.data.rop})}).catch(function(t){a.showLoading=!1})},dels:function(){for(var t=this,e=[],a=0;a<this.selectData.length;a++)e.push(this.selectData[a].id);!e||e.length<1?this.$message.error("请选择需要删除掉的人员."):(this.showLoading=!0,this.apiSrv.callServer("/policydel",e).then(function(e){t.showLoading=!1,t.callSrvAct("/policylist",{user_title:"",cp:t.policyCurPage,rop:t.policyRecOfPage}).then(function(e){t.policyData=e.data.pageData||[],t.policyTotalRec=e.data.totalRec,t.policyCurPage=e.data.cp,t.this.policyRecOfPage=e.data.rop})}).catch(function(e){t.showLoading=!1}))},policySizeChange:function(t){var e=this;this.callSrvAct("/policylist",{user_title:this.user_title,org_id:this.org_id,starttime:this.txTime[0],endtime:this.txTime[1],gateway_title:this.gateway_title,cardnumber:this.cardnumber,idnumber:this.idnumber,cp:this.policyCurPage,rop:t}).then(function(t){e.policyData=t.data.pageData||[],e.policyTotalRec=t.data.totalRec,e.policyCurPage=t.data.cp,e.policyRecOfPage=t.data.rop})},policyCurChange:function(t){var e=this;this.callSrvAct("/policylist",{user_title:this.user_title,org_id:this.org_id,starttime:this.txTime[0],endtime:this.txTime[1],gateway_title:this.gateway_title,cardnumber:this.cardnumber,idnumber:this.idnumber,cp:t,rop:this.policyRecOfPage}).then(function(t){e.policyData=t.data.pageData||[],e.policyTotalRec=t.data.totalRec,e.policyCurPage=t.data.cp,e.policyRecOfPage=t.data.rop})}},watch:{},computed:{},beforeCreate:function(){},created:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){}},i=(a("CXAN"),a("KHd+")),n=Object(i.a)(l,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticStyle:{height:"100%"},attrs:{direction:"vertical"}},[a("div",[a("el-row",[a("el-col",{attrs:{span:6}},[a("span",[t._v("人员部门\n                ")]),t._v(" "),a("el-select",{ref:"depttree",staticStyle:{width:"calc(100% - 76px)"},attrs:{filterable:!0,"filter-method":t.filterDepart,id:"depttree"},model:{value:t.deptShowVal,callback:function(e){t.deptShowVal=e},expression:"deptShowVal"}},[a("el-option",{staticStyle:{"min-height":"30px",background:"#fff"},attrs:{value:t.org_id,label:t.tsSelLabel}},[a("el-tree",{ref:"depttreein",attrs:{accordion:!1,"node-key":"id",data:t.tsData,props:t.deptProps,"filter-node-method":t.filterDeptNode},on:{"node-click":t.handleDeptNodeClick}})],1)],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("span",[t._v("通行时间\n                ")]),t._v(" "),a("el-date-picker",{staticStyle:{width:"calc(100% - 76px)"},attrs:{"value-format":"timestamp",editable:!1,clearable:!1,"start-placeholder":"开始时间","end-placeholder":"结束时间",type:"datetimerange","range-separator":"-"},model:{value:t.txTime,callback:function(e){t.txTime=e},expression:"txTime"}})],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("span",[t._v("设备名称\n                ")]),t._v(" "),a("el-input",{staticStyle:{width:"calc(100% - 76px)"},model:{value:t.gateway_title,callback:function(e){t.gateway_title=e},expression:"gateway_title"}})],1)],1)],1),t._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("span",{staticStyle:{"margin-left":"30px"}},[t._v("姓名\n                ")]),t._v(" "),a("el-input",{staticStyle:{width:"calc(100% - 76px)"},model:{value:t.user_title,callback:function(e){t.user_title=e},expression:"user_title"}})],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("span",{staticStyle:{"margin-left":"30px"}},[t._v("工号\n                ")]),t._v(" "),a("el-input",{staticStyle:{width:"calc(100% - 76px)"},model:{value:t.cardnumber,callback:function(e){t.cardnumber=e},expression:"cardnumber"}})],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("span",[t._v("身份证号\n                ")]),t._v(" "),a("el-input",{staticStyle:{width:"calc(100% - 76px)"},model:{value:t.idnumber,callback:function(e){t.idnumber=e},expression:"idnumber"}})],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary"},on:{click:t.search}},[a("span",[t._v("搜索\n                    ")])])],1)],1)],1),t._v(" "),a("div",{staticStyle:{display:"flex",margin:"10px 0px"}},[a("el-button",{on:{click:t.dis}},[a("span",[t._v("分配权限\n            ")])]),t._v(" "),a("el-button",{attrs:{type:"danger",loading:t.showLoading},on:{click:t.dels}},[a("span",[t._v("删除\n            ")])])],1),t._v(" "),a("el-table",{ref:"policy",staticStyle:{margin:"10px 0px"},attrs:{stripe:!0,border:!0,height:t.tableHeight,"header-cell-style":{background:"#E6F4FF",fontWeight:"500",color:"#0A51C4",borderBottom:"2px solid #4093F7"},"default-sort":{id:"descending"},id:"policy",data:t.policyData},on:{"selection-change":t.handleChange}},[a("el-table-column",{attrs:{label:"全选",type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{label:"姓名",prop:"user_title",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"性别",prop:"gender",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"部门",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"身份证号",prop:"idnumber",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"工号",prop:"cardnumber",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"设备名称",prop:"gateway_title",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"允许通行时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t.timess(e.row.starttime))+"\n                ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"允许结束时间",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t.timess(e.row.endtime))+"\n                ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"被访人员",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"state",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",loading:t.showLoading},on:{click:function(a){t.del(e.$index,e.row)}}},[a("span",[t._v("删除\n                    ")])])]}}])})],1),t._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("el-pagination",{attrs:{"page-size":t.policyRecOfPage,total:t.policyTotalRec,"page-count":t.policyTotalPage,"current-page":t.policyCurPage,layout:"total, sizes, prev, pager, next"},on:{"size-change":t.policySizeChange,"current-change":t.policyCurChange}})],1)],1)},[],!1,null,"4efe80b6",null);n.options.__file="index.vue";e.default=n.exports},nvJI:function(t,e,a){}}]);