(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6d01"],{"6bP5":function(e,t,a){"use strict";var i=a("Qq1u");a.n(i).a},PZHG:function(e,t,a){"use strict";var i=a("nZPP");a.n(i).a},Qq1u:function(e,t,a){},SyN2:function(e,t,a){"use strict";a.r(t);var i=a("y2a5"),s=a("itRl"),l={name:"rolepage",mixins:[i.a],components:{TreeTable:s.a},data:function(){return{isLoading:!1,pageQueryArr:[{name:"role_id",val:this.$route.params.id,tb:"role_page"}],btnQueryArr:[{name:"page_id",val:[],op:"in"}],btnSortParas:[{name:"page_id",orderV:"asc"},{name:"sort",orderV:"asc"}],btnRecOfPage:1e4,btnCurPage:1,pageSel:[],fullSel:!1,rolePageDatas:[],roleId:this.$route.params.id,roleName:this.$route.params.title}},mounted:function(){this.getListData(1e4,1)},methods:{savePageSel:function(){var e=this;if(this.pageSel&&!(this.pageSel.length<1)){for(var t=[],a=0;a<this.pageSel.length;a++)t.push({page_id:this.pageSel[a],role_id:this.$route.params.id});for(var i=[],s=this.getChildData(0),l=0;l<s.length;l++){this.pageSel.indexOf(s[l].id)<0&&(console.log("top:"+s[l].id),i.push(s[l].id));for(var n=this.getChildData(s[l].id),h=0;h<n.length;h++)this.pageSel.indexOf(n[h].id)<0&&(console.log("child:"+n[h].id),i.push(n[h].id))}var o={_hy:"rolepagejoin",role_page:t,rm_role_page:i,thirdUUID:this.$route.params.thirdUUID,roleName:this.roleName,roleId:this.roleId};this.callSrvAct("/act",o).then(function(t){e.$message({showClose:!0,message:"给角色添加页面权限成功.",type:"success"})})}},clearRolePage:function(){},handleClose:function(){this.$router.go(-1)},checkChangedFull:function(e){if(e)for(var t=0;t<this.rolePageDatas.length;t++)"t"!=this.rolePageDatas[t].is_menu&&"t"!=this.rolePageDatas[t].client_route||this.pageSel.indexOf(this.rolePageDatas[t].id)<0&&this.pageSel.push(this.rolePageDatas[t].id);else this.pageSel=[]},isCheckPage:function(e){var t=this.pageSel.indexOf(e)>-1;return console.log("checked:",t),t},checkRelationFull:function(){for(var e=this.getChildData(0),t=!1,a=0;a<e.length;a++)if(this.pageSel.indexOf(e[a].id)>-1){t=!0;break}this.fullSel=t},checkRelationChange:function(e,t){for(var a=null,i=0;i<this.rolePageDatas.length;i++)if(this.rolePageDatas[i].id==e){a=this.rolePageDatas[i];break}if(a)if(0==a.parent_id)if(t){for(var s=this.getChildData(a.id),l=0;l<s.length;l++)this.pageSel.indexOf(s[l].id)<0&&this.pageSel.push(s[l].id);this.checkRelationFull()}else{for(var n=this.getChildData(a.id),h=0;h<n.length;h++)if(this.pageSel.indexOf(n[h].id)>-1)for(var o=0;o<this.pageSel.length;o++)if(this.pageSel[o]==n[h].id){this.pageSel.splice(o,1);break}this.checkRelationFull()}else if(t)this.pageSel.indexOf(a.parent_id)<0&&(this.pageSel.push(a.parent_id),this.checkRelationFull());else{for(var r=this.getChildData(a.parent_id),g=!1,p=0;p<r.length;p++)if(this.pageSel.indexOf(r[p].id)>-1){g=!0;break}if(!g){if(this.pageSel.indexOf(a.parent_id)>-1)for(var c=0;c<this.pageSel.length;c++)if(this.pageSel[c]==a.parent_id){this.pageSel.splice(c,1);break}this.checkRelationFull()}}},checkChangedMenu:function(e,t){if(this.pageSel.indexOf(t)>-1){for(var a=0;a<this.pageSel.length;a++)if(this.pageSel[a]==t){this.pageSel.splice(a,1);break}this.checkRelationChange(t,!1)}else this.pageSel.push(t),this.checkRelationChange(t,!0)},checkChanged:function(e,t){if(console.log("val:pageId:",e,t),this.pageSel.indexOf(t)>-1){for(var a=0;a<this.pageSel.length;a++)if(this.pageSel[a]==t){this.pageSel.splice(a,1);break}this.checkRelationChange(t,!1)}else this.pageSel.push(t),this.checkRelationChange(t,!0)},getChildData:function(e){for(var t=[],a=0;a<this.rolePageDatas.length;a++)this.rolePageDatas[a].parent_id!=e||"t"!=this.rolePageDatas[a].is_menu&&"t"!=this.rolePageDatas[a].client_route||t.push(this.rolePageDatas[a]);return t},getListData:function(e,t){var a=this;this.isLoading=!0;var i={_hy:"rolepagemmlist",qps:this.pageQueryArr,sps:this.pageSortParas,rop:e,cp:t};this.callSrvAct("/actq",i).then(function(e){e.data&&"SUCCESS"==e.status?(a.rolePageDatas=e.data.pageData||[],console.log("rolePageDatas:",a.rolePageDatas),a.$nextTick(function(){a.isLoading=!1;for(var e=0;e<a.rolePageDatas.length;e++)a.rolePageDatas[e].join_id&&a.pageSel.push(a.rolePageDatas[e].id);a.checkRelationFull()})):a.isLoading=!1})}}},n=(a("WOu1"),a("KHd+")),h=Object(n.a)(l,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{direction:"vertical"}},[a("div",[a("h2",[e._v('给"'+e._s(e.roleName)+'"分配访问权限：')])]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading.body",value:e.isLoading,expression:"isLoading",modifiers:{body:!0}}],staticStyle:{"padding-left":"70px"}},[a("div",{staticStyle:{"margin-top":"20px"}},[a("el-checkbox",{on:{change:function(t){return e.checkChangedFull(t)}},model:{value:e.fullSel,callback:function(t){e.fullSel=t},expression:"fullSel"}},[a("span",{staticStyle:{"font-size":"18px",color:"#000000"}},[e._v("全选\n                ")])])],1),e._v(" "),e._l(e.getChildData(0),function(t,i){return a("div",{key:t.id,staticStyle:{"margin-top":"20px"},attrs:{label:t.title,value:e.isCheckPage(t.id)}},[a("el-checkbox",{attrs:{value:e.isCheckPage(t.id)},on:{change:function(a){return e.checkChangedMenu(a,t.id)}}},[a("span",{staticStyle:{"font-size":"18px",color:"#000000"}},[e._v(e._s(t.title)+"\n                ")])]),e._v(" "),a("div",{staticStyle:{"margin-top":"10px","margin-left":"100px"}},e._l(e.getChildData(t.id),function(t,i){return a("el-checkbox",{key:t.id,attrs:{label:t.title,value:e.isCheckPage(t.id)},on:{change:function(a){return e.checkChanged(a,t.id)}}},[a("span",[e._v(e._s(t.title)+"\n                    ")])])}))],1)})],2),e._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"30px"}},[a("el-button",{on:{click:e.handleClose}},[a("span",[e._v("返回\n          ")])]),e._v(" "),a("el-button",{on:{click:e.clearRolePage}},[a("span",[e._v("重置\n            ")])]),e._v(" "),a("el-button",{staticStyle:{"background-color":"#317EF3"},on:{click:e.savePageSel}},[a("span",{staticStyle:{color:"#ffffff"}},[e._v("保存\n            ")])])],1)])},[],!1,null,"75fd7f8e",null);h.options.__file="index.vue";t.default=h.exports},WOu1:function(e,t,a){"use strict";var i=a("yn/T");a.n(i).a},itRl:function(e,t,a){"use strict";var i={name:"TreeTable",props:{showProps:{type:Object,required:!0},sortName:{type:String,default:""},keyPropType:{type:String,default:"number"},parentProp:{type:String,default:"parent_id"},fetchTreeData:{type:Function,required:!0}},data:function(){return{tableData:[]}},mounted:function(){var e="string"==this.keyPropType?"":-1;this.fetchTreeData(e,this.appendData)},methods:{showRow:function(e){return e.row._show?"animation:treeTableShow 1s;-webkit-animation:treeTableShow 1s;":"display:none;"},getTreeData:function(){return this.tableData},clearData:function(){this.tableData=[]},resetData:function(){this.tableData=[];var e="string"==this.keyPropType?"":-1;this.fetchTreeData(e,this.appendData)},expand:function(){for(var e=0;e<this.tableData.length;e++)if(this.tableData[e].hy_extra_num>1&&!this.tableData[e]._expanded){this.toggleExpanded(e);break}},collapse:function(){for(var e=0;e<this.tableData.length;e++)if(this.tableData[e].hy_extra_num>1&&this.tableData[e]._expanded){this.toggleExpanded(e);break}},appendData:function(e,t){if(t&&t.length>0){for(var a=0,i=0,s=1,l=0;l<this.tableData.length;l++)if(this.tableData[l][this.showProps.key]==e){a=l+1,s=(i=this.tableData[l]._level)+1;break}if(this.isSort){var n=a;for(n=a;n<this.tableData.length;n++){if(this.tableData[n]._level==s&&this.tableData[n].sort>t[0].sort){a=n;break}if(this.tableData[n]._level<s){a=n;break}}n<0&&(n=0),n>this.tableData.length&&(a=this.tableData.length)}for(var h=t.length-1;h>-1;h--)t[h]._expanded=!1,t[h]._show=!0,t[h]._level=i+1,this.tableData.splice(a,0,t[h])}},deleteChildData:function(e){if("string"==this.keyPropType){for(var t=this.tableData.length;t--;)if(this.tableData&&this.tableData[t]){var a=this.tableData[t][this.showProps.key];a&&a.length>=2&&a.substr(0,a.length-2)==e&&(this.tableData.splice(t,1),this.deleteChildData(a))}}else for(var i=this.tableData.length;i--;)if(this.tableData&&this.tableData[i]&&this.tableData[i][this.parentProp]==e){var s=this.tableData[i][this.showProps.key];this.tableData.splice(i,1),this.deleteChildData(s)}},deleteData:function(e){if(1==e.length){for(var t="",a="",i=void 0,s=0;s<this.tableData.length;s++)if(this.tableData[s].id==e[0]){i=this.tableData[s],"string"==this.keyPropType?t=(a=i[this.showProps.key])&&a.length>=2?a.substr(0,a.length-2):"":(a=i[this.showProps.key],t=i[this.parentProp]),this.tableData.splice(s,1);break}for(s=0;s<this.tableData.length;s++)if(this.tableData[s][this.showProps.key]==t){this.tableData[s].hy_extra_num>1&&(this.tableData[s].hy_extra_num=this.tableData[s].hy_extra_num-1);break}a&&a.length>0&&this.deleteChildData(a)}},upInstProp:function(e,t,a){for(var i=0;i<this.tableData.length;i++)if(this.tableData[i].id==e){this.tableData[i][t]=a;break}},adjustUpInst:function(e){},adjustSort:function(e){var t=void 0;"string"==this.keyPropType?(t="",e[this.showProps.key]&&e[this.showProps.key].length>2&&(t=e[this.showProps.key].substr(0,e[this.showProps.key].length-2))):"number"==this.showProps.key&&(t=e[this.parentProp]);for(var a=-1,i=0;i<this.tableData.length;i++)if(this.tableData[i][this.showProps.key]==e[this.showProps.key]){a=i;break}a>-1&&this.tableData.splice(a,1);for(var s=-1,l=0;l<this.tableData.length;l++)if(this.tableData[l][this.showProps.key]!=t){if(this.tableData[l]._level==e._level&&(s<0&&(s=l),this.tableData[l].sort>e.sort))return void this.tableData.splice(l,0,e);if(s>0&&this.tableData[l]._level<e._level)return void this.tableData.splice(l,0,e)}else s=l+1;this.tableData.push(e)},toggleShow:function(e,t,a,i){for(var s=t;s<e.length;s++)this.isPcRelation(a,e[s])&&(e[s]._show=i,e[s].hy_extra_num>1&&e[s]._expanded?this.toggleShow(e,s+1,e[s][this.showProps.key],i):this.toggleShow(e,s+1,e[s][this.showProps.key],!1))},isPcRelation:function(e,t){if(!t)return!1;if(console.log("isPcRelation:",e,t),"string"==this.keyPropType)return console.log("222:",e,t.code),0==t.code.indexOf(e);if("number"==this.keyPropType){console.log("333:",e,t[this.parentProp],this.parentProp);var a=t[this.parentProp]==e;return console.log("test:",a),a}return console.log("kdkkdk"),!1},toggleExpanded:function(e){console.log("trIndex:",e);var t=this.tableData[e];t._expanded=!t._expanded;var a=!!t._expanded;if(console.log("trIndex data:",e,t),t.hy_extra_num>1){for(var i=!1,s=e+1;s<this.tableData.length;s++)if(this.isPcRelation(t[this.showProps.key],this.tableData[s])){i=!0;break}console.log("childDataExist :",i),i?(console.log("toggleShow :"),this.toggleShow(this.tableData,e+1,t[this.showProps.key],a)):(console.log("fetchTreeData :"),this.fetchTreeData&&this.fetchTreeData(t[this.showProps.key],this.appendData))}}}},s=(a("6bP5"),a("PZHG"),a("KHd+")),l=Object(s.a)(i,function(){var e=this.$createElement;return(this._self._c||e)("el-table",{staticStyle:{width:"100%"},attrs:{data:this.tableData,stripe:"",border:"","row-style":this.showRow}},[this._t("default")],2)},[],!1,null,"ee75c35c",null);l.options.__file="index.vue";t.a=l.exports},nZPP:function(e,t,a){},"yn/T":function(e,t,a){}}]);