(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-de9f","chunk-06e0"],{"/qDw":function(t,e,r){"use strict";var n=r("19WG");r.n(n).a},"19WG":function(t,e,r){},OYHo:function(t,e,r){},"RU/L":function(t,e,r){r("Rqdy");var n=r("WEpk").Object;t.exports=function(t,e,r){return n.defineProperty(t,e,r)}},Rqdy:function(t,e,r){var n=r("Y7ZC");n(n.S+n.F*!r("jmDH"),"Object",{defineProperty:r("2faE").f})},SEkw:function(t,e,r){t.exports={default:r("RU/L"),__esModule:!0}},"U+t5":function(t,e,r){"use strict";r.r(e);var n=r("P2sY"),a=r.n(n),i=r("YEIV"),o=r.n(i),s={name:"orgedit",mixins:[r("y2a5").a],components:{},props:{paramsObj:{type:Object,default:function(){return{}}}},data:function(){var t;return t={newOrgForm:{id:0,title:"",type:"",parent_id:0,sort:0,data_scope:"",stop:"",memo:""},orgForm:{},orgData:[]},o()(t,"newOrgForm",{id:0,title:"",type:"部门",parent_id:0,sort:0,data_scope:"f",stop:"f",memo:""}),o()(t,"isInDialog",!1),o()(t,"pObj",{}),t},mounted:function(){console.log(" xxxxxx ------ "),this.pObj=a()({},this.paramsObj),this.gcomm.mapLength(this.pObj)>0?(this.isInDialog=!0,this.orgForm=a()({},this.newOrgForm,this.pObj)):this.orgForm=a()({},this.newOrgForm,this.$route.params)},methods:{pObjChanged:function(){this.gcomm.mapLength(this.pObj)>0&&(this.isInDialog=!0,this.orgForm=a()({},this.newOrgForm,this.pObj))},changedc6d8:function(t){for(var e=0;e<this.orgData.length;e++)this.orgData[e].id==this.orgForm.parent_id&&(this.orgForm.parent_title=this.orgData[e].title)},clickf5e8c:function(){this.submitOrgForm("orgForm")},handleClose:function(){this.isInDialog?this.$emit("submitClose"):this.$router.go(-1)},submitOrgFormImpl:function(t){var e=this,r=void 0,n=!0,i="";this[t].id>0?(r="/act",n=!1,i="deptup"):(r="/act",i="deptadd");var o=a()({},this[t]);o._hy=i,this.callSrvAct(r,o).then(function(t){console.log("res:",t,e.isInDialog),e.isInDialog?n?t.data&&t.data.inst?e.$emit("submitOk",t.data.inst):t.data&&e.$emit("submitOk",t.data||{}):e.$emit("submitOk",o):e.$router.go(-1)})},submitOrgForm:function(t){var e=this;this.$refs[t].validate(function(r){if(!r)return!1;e.submitOrgFormImpl(t)})}},watch:{paramsObj:function(t){this.pObj.id!=this.paramsObj.id&&(this.pObj=a()({},this.paramsObj),this.pObjChanged())}},computed:{},beforeCreate:function(){},created:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){}},l=(r("eLV9"),r("KHd+")),c=Object(l.a)(s,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-container",{attrs:{direction:"vertical"}},[r("el-form",{ref:"orgForm",staticStyle:{padding:"10px"},attrs:{model:t.orgForm,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"部门名称",prop:"title",rules:{required:!0,message:"请输入正确的部门名称",trigger:"blur",min:1,max:200}}},[r("el-input",{model:{value:t.orgForm.title,callback:function(e){t.$set(t.orgForm,"title",e)},expression:"orgForm.title"}})],1),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),t._e(),t._v(" "),r("el-row",{attrs:{type:"flex",justify:"center"}},[r("el-button",{on:{click:t.clickf5e8c}},[r("span",[t._v("确定\n                    ")])]),t._v(" "),r("el-button",{on:{click:t.handleClose}},[r("span",[t._v("取消\n                    ")])])],1)],1)],1)},[],!1,null,"a9318a8e",null);c.options.__file="index.vue";e.default=c.exports},YEIV:function(t,e,r){"use strict";e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(r("SEkw"));e.default=function(t,e,r){return e in t?(0,n.default)(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},eLV9:function(t,e,r){"use strict";var n=r("OYHo");r.n(n).a},zMcA:function(t,e,r){"use strict";r.r(e);var n=r("m1cH"),a=r.n(n),i=r("gDS+"),o=r.n(i),s=r("YEIV"),l=r.n(s),c=r("y2a5"),u=r("U+t5"),d={name:"pmanagement",mixins:[c.a],components:{Orgedit:u.default},props:{},data:function(){var t;return t={newPersoneForm:{id:0,name:"",jobno:"",idnumber:""},personeForm:{},userData:[],userTotalRec:0,userTotalPage:0,userRecOfPage:10,userCurPage:1,userCbPage:this.gen_list_cb("user"),userQueryArr:[{name:"title",val:"",op:"like",tb:""},{name:"user_name",val:"",op:"like",tb:"user"},{name:"idnumber",val:"",op:"like",tb:""},{name:"mobile",val:"",op:"like",tb:"user"},{name:"parent_id",val:0,tb:"user"}],userQueryInit:[{name:"title",val:"",op:"like",tb:""},{name:"user_name",val:"",op:"like",tb:"user"},{name:"idnumber",val:"",op:"like",tb:""},{name:"mobile",val:"",op:"like",tb:"user"},{name:"parent_id",val:0,tb:"user"}],userMultiSel:[],showEditOrgSet:!1,orgInstEdit:null,show:!1,orgDepartDatas:[],orgQueryArr:[{name:"title",val:"",op:"like"},{name:"type",val:"部门",op:"="},{name:"stop",val:"f",op:"like"}],orgSortParas:[{name:"title",orderV:"asc"}],orgTtData:[]},l()(t,"showEditOrgSet",!1),l()(t,"orgInstEdit",null),l()(t,"actAdd",!1),l()(t,"show",!1),l()(t,"cardno",""),l()(t,"cardparameter",{}),l()(t,"departmentList",[]),t},mounted:function(){this.refreshPage("user","/actq","userlist"),this.getDepartDatas()},methods:{userMultiSelChange:function(t){this.userMultiSel=t},userQuery:function(){this.refreshPage2("user","/actq",this.remoteRecOfPage,1,"userlist")},userResetQuery:function(){this.userQueryArr=JSON.parse(o()(this.userQueryInit))},userSizeChange:function(t){this.refreshPage2("user","/actq",t,this.userCurPage,"userlist")},userCurChange:function(t){this.refreshPage2("user","/actq",this.userRecOfPage,t,"userlist")},getDepartDatas:function(){var t=this,e={_hy:"departlist",qps:[{name:"type",val:"部门",op:"=",tb:"org"},{name:"stop",val:"f",op:"like",tb:"org"}],sps:this.orgSortParas};this.callSrvAct("/actq",e).then(function(e){t.orgDepartDatas=e.data||[],t.getOrgTtData(0)})},filterDept:function(){this.getOrgTtData(0)},queryDepartById2:function(t,e){for(var r=[],n=0;n<this.orgDepartDatas.length;n++)this.orgDepartDatas[n].parent_id==t&&this.orgDepartDatas[n].title.indexOf(e)>-1&&r.push(this.orgDepartDatas[n]);return r},queryDepartById:function(t,e){for(var r=[],n=0;n<this.orgDepartDatas.length;n++)console.log("testddd:",this.orgDepartDatas[n].parent_id==t),this.orgDepartDatas[n].parent_id==t&&this.orgDepartDatas[n].title.indexOf(e)>-1&&r.push(this.orgDepartDatas[n]);console.log("queryData:",r);for(var a=0;a<r.length;a++){var i=this.queryDepartById2(r[a].id,e);console.log("retArr2:",i),r[a].hy_extra_num=i?i.length+1:1,r[a].children||(r[a].children=[])}return console.log("queryData 2:",r),r},rmObjFromTreeData:function(t,e){if(t&&!(t.length<1)&&e){for(var r=t.length-1;r>-1;r--)console.log("i:",t[r],e.indexOf(t[r].id)),e.indexOf(t[r].id)>-1&&(console.log("rm arr,i",t,r),t.splice(r,1));for(var n=0;n<t.length;n++)t[n].children&&t[n].children.length>0&&this.rmObjFromTreeData(t[n].children,e)}},getOrgTtData:function(t,e){var r=this;JSON.parse(o()(this.orgQueryArr));t>0||(this.orgTtData=[]);for(var n=this.queryDepartById(t,this.orgQueryArr[0].val),a=0;a<n.length;a++)n[a].isLeaf=n[a].hy_extra_num<2,n[a].children||(n[a].children=[]);this.appendData(t,n),e&&this.$nextTick(function(){e.expanded=!0,r.$set(r,"orgTtData",JSON.parse(o()(r.orgTtData)))})},search:function(){this.refreshPage("user","/actq","userlist")},add:function(){this.$router.push({name:"personedit"})},hairpin:function(t,e){this.show=!0,this.cardparameter=e},determine:function(){var t=this;console.log("11111111111111111111");var e={};e.user_name=this.cardparameter.title,e.state="正常",e.user_id=this.cardparameter.id,e._hy="usercardadd",e.cardno=this.cardno,this.callSrvAct("/act",e).then(function(e){console.log("返回值",e),t.show=!1,t.cardparameter={},t.cardno="",t.refreshPage("user","/actq","userlist")})},hairpinclose:function(){this.show=!1,this.cardparameter={},this.cardno=""},handleUserEdit:function(t,e){console.log("index:row:",t,e),this.$router.push({name:"personedit",params:e})},handleChange:function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].id);this.userMultiSel=e},handleUserDelBatch:function(){var t=this;!this.userMultiSel||this.userMultiSel.length<1||this.$confirm("删除用户后不能恢复，确认删除？","删除用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e={_hy:"userdel",user:[{name:"id",val:t.userMultiSel,op:"in"}],org:[{name:"id",val:t.userMultiSel,op:"in"}],user_role:[{name:"user_id",val:t.userMultiSel,op:"in"}]};t.callSrvAct("/act",e).then(function(e){t.refreshPage("user","/actq","userlist")})}).catch(function(t){})},handleUserDel:function(t,e){var r=this;this.$confirm("删除用户后不能恢复，确认删除？","删除用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={_hy:"userdel",user:[{name:"id",val:[e.id],op:"in"}],org:[{name:"id",val:[e.id],op:"in"}],user_role:[{name:"user_id",val:[e.id],op:"in"}]};r.callSrvAct("/act",t).then(function(t){r.refreshPage("user","/actq","userlist")})}).catch(function(t){})},getChildId:function(t){for(var e=JSON.parse(o()(t)),r=!0;r;){r=!1;for(var n=0;n<this.orgDepartDatas.length;n++)console.log("i:",n,e.indexOf(this.orgDepartDatas[n].parent_id),e),e.indexOf(this.orgDepartDatas[n].id)<0&&e.indexOf(this.orgDepartDatas[n].parent_id)>-1&&(e.push(this.orgDepartDatas[n].id),r=!0)}return console.log("delIds -----",e),e},delOrgs:function(){var t=this,e=this.$refs.org.getCurrentKey();console.log("selId:",e),e&&this.$confirm("确认删除？此部门下的子部门将会一并删除","删除部门",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var r=t.getChildId([e]);if(console.log("delIds:",r),r&&r.length>0){console.log("delIds 3",r);var n={_hy:"orgdel",org:[{name:"id",val:r,op:"in"}]};t.callSrvAct("/act",n).then(function(e){t.rmObjFromTreeData(t.orgTtData,r);for(var n=t.orgDepartDatas.length-1;n>-1;n--)r.indexOf(t.orgDepartDatas[n].id)>-1&&t.orgDepartDatas.splice(n,1);t.$nextTick(function(){t.$set(t,"orgTtData",JSON.parse(o()(t.orgTtData)))})})}}).catch(function(t){})},setObjInParentArr:function(t,e){var r=!1;if(t){console.log("setObjInParentArr: ----1");for(var n=0;n<t.length;n++)if(console.log("setObjInParentArr: ----12"),t[n].title>e.title){var a=t[n];t.splice(n,1,e,a),r=!0;break}console.log("setObjInParentArr: ----22"),r||t.push(e),console.log("setObjInParentArr: ----3")}},rmObjFromParentArr:function(t,e){if(t&&!(t.length<1)&&e)for(var r=0;r<t.length;r++)if(t[r].id==e.id)return void t.splice(r,1)},setOrgItem:function(t,e){console.log("setPageItem: ----1",e);var r=this.findOrgItem(t,e.id);if(console.log("oldObj:",r),r)if(r.parent_id>0){var n=this.findOrgItem(this.orgTtData,r.parent_id);console.log("oldObjParent:",n),n&&(this.rmObjFromParentArr(n.children,r),n.hy_extra_num=n.children.length+1,n.isLeaf=n.hy_extra_num<2)}else this.rmObjFromParentArr(this.orgTtData,r);if(console.log("setPageItem: ----2"),e.parent_id<1)return console.log("setPageItem: ----3"),void this.setObjInParentArr(this.orgTtData,e);console.log("setPageItem: ----4");var a=this.findOrgItem(this.orgTtData,e.parent_id);a&&(console.log("setPageItem: ----5"),this.setObjInParentArr(a.children,e),a.hy_extra_num=a.children.length+1,a.isLeaf=a.hy_extra_num<2),console.log("setPageItem: ----6")},editOrgSetOK:function(t,e){console.log("evt:",t,e),t.children||(t.children=[]),t.hy_extra_num||(t.hy_extra_num=t.children.length+1),this.actAdd&&this.orgDepartDatas.push(t),this.setOrgItem(this.orgTtData,t),this.orgInstEdit={},this.showEditOrgSet=!1},editOrgSet:function(){var t=this.$refs.org.getCurrentKey();t||(t=0);var e=this.findOrgItem(this.orgTtData,t);e&&(this.orgInstEdit=JSON.parse(o()(e)),this.actAdd=!1,this.showEditOrgSet=!0)},addNewOrg:function(){var t=this.$refs.org.getCurrentKey();t||(t=0),console.log("selId:",t),this.orgInstEdit=!t||t<1?{id:0,title:"",type:"部门",parent_id:0,sort:0,data_scope:"f",stop:"f",memo:""}:{id:0,title:"",type:"部门",parent_id:t,sort:0,data_scope:"f",stop:"f",memo:""},this.actAdd=!0,this.showEditOrgSet=!0},findOrgItem:function(t,e){if(!t||t.length<1)return null;for(var r=0;r<t.length;r++)if(console.log("arr,",r,t[r].id,e,t[r].id==e),t[r].id==e)return t[r];for(var n=0;n<t.length;n++)if(t[n].children&&t[n].children.length>0){var a=this.findOrgItem(t[n].children,e);if(a)return a}return null},appendData:function(t,e){if(t<1){var r;e&&e.length>0&&(r=this.orgTtData).push.apply(r,a()(e))}else{var n=this.findOrgItem(this.orgTtData,t);n&&(n.children=e||[],n.hy_extra_num=n.children.length+1)}},clickTreeItem:function(t,e){console.log("node:",t),t.hy_extra_num>1&&(!t.children||t.children.length<1)&&this.getOrgTtData(t.id,e),0==t.parent_id?(this.userQueryArr[4].val=this.getChildId([0]),this.userQueryArr[4].op="in"):(this.userQueryArr[4].val=this.getChildId([t.id]),this.userQueryArr[4].op="in"),this.search()},orgTreeCheck:function(t,e){},genDownUrl:function(t){if(!t||t.length<1)return"";var e=t.split(";");return!e||e.length<2?"":this.hysrvport+"/hydownload?btnEncode=headupload&relateType=camera&filename="+e[1]+"&Authorization="+this.apiSrv.token},lotimport:function(){this.$router.push({name:"batchimport"})}},watch:{},computed:{},beforeCreate:function(){},created:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeDestroy:function(){},destroyed:function(){}},h=(r("/qDw"),r("KHd+")),p=Object(h.a)(d,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-container",{staticStyle:{height:"100%"},attrs:{direction:"horizontal"}},[r("el-aside",{attrs:{width:"250px"}},[r("div",{staticStyle:{display:"flex","justify-content":"space-around",width:"100%"}},[r("span",{staticStyle:{display:"block","font-size":"24px","font-weight":"800"},on:{click:t.addNewOrg}},[r("i",{staticClass:"el-icon-plus"})]),t._v(" "),r("span",{staticStyle:{display:"block","font-size":"24px","font-weight":"800"},on:{click:t.editOrgSet}},[r("i",{staticClass:"el-icon-edit"})]),t._v(" "),r("span",{staticStyle:{display:"block","font-size":"24px","font-weight":"800"},on:{click:t.delOrgs}},[r("i",{staticClass:"el-icon-delete"})])]),t._v(" "),r("el-input",{staticStyle:{margin:"10px",width:"270px"},attrs:{placeholder:"搜索部门名称"},on:{change:t.filterDept},model:{value:t.orgQueryArr[0].val,callback:function(e){t.$set(t.orgQueryArr[0],"val",e)},expression:"orgQueryArr[0].val"}}),t._v(" "),r("el-tree",{ref:"org",staticClass:"\t.el-tree-node__label",attrs:{"node-key":"id",props:{label:"title",disabled:!1,isLeaf:!0,children:"children"},"highlight-current":!0,"default-expand-all":!0,data:t.orgTtData},on:{"node-click":t.clickTreeItem}})],1),t._v(" "),r("el-main",{staticStyle:{height:"100%"}},[r("div",{staticStyle:{display:"flex"}},[r("div",[r("span",[t._v("姓名\n                ")]),t._v(" "),r("el-input",{staticStyle:{width:"150px"},model:{value:t.userQueryArr[0].val,callback:function(e){t.$set(t.userQueryArr[0],"val",e)},expression:"userQueryArr[0].val"}})],1),t._v(" "),r("div",{staticStyle:{"margin-left":"6px"}},[r("span",[t._v("工号\n                ")]),t._v(" "),r("el-input",{staticStyle:{width:"150px"},model:{value:t.userQueryArr[1].val,callback:function(e){t.$set(t.userQueryArr[1],"val",e)},expression:"userQueryArr[1].val"}})],1),t._v(" "),r("div",{staticStyle:{"margin-left":"6px"}},[r("span",[t._v("身份证号\n                ")]),t._v(" "),r("el-input",{staticStyle:{width:"150px"},model:{value:t.userQueryArr[2].val,callback:function(e){t.$set(t.userQueryArr[2],"val",e)},expression:"userQueryArr[2].val"}})],1),t._v(" "),r("div",{staticStyle:{"margin-left":"6px"}},[r("span",[t._v("手机号\n                ")]),t._v(" "),r("el-input",{staticStyle:{width:"150px"},model:{value:t.userQueryArr[3].val,callback:function(e){t.$set(t.userQueryArr[3],"val",e)},expression:"userQueryArr[3].val"}})],1),t._v(" "),r("el-button",{staticStyle:{"margin-left":"6px"},attrs:{type:"primary"},on:{click:t.search}},[r("span",[t._v("搜索\n                ")])])],1),t._v(" "),r("div",{staticStyle:{display:"flex","margin-top":"6px"}},[r("el-button",{attrs:{size:"mini"},on:{click:t.add}},[r("span",{staticStyle:{"font-size":"14px"}},[t._v("新增\n                ")])]),t._v(" "),r("el-button",{on:{click:t.lotimport}},[r("span",[t._v("批量导入\n                ")])]),t._v(" "),r("el-button",{attrs:{type:"danger"},on:{click:t.handleUserDelBatch}},[r("span",[t._v("批量删除\n                ")])])],1),t._v(" "),r("el-table",{ref:"user",staticStyle:{"margin-top":"10px"},attrs:{stripe:!0,border:!0,"header-cell-style":{background:"#E6F4FF",fontWeight:"500",color:"#0A51C4",borderBottom:"2px solid #4093F7"},"default-sort":{order:"descending"},data:t.userData},on:{"selection-change":t.handleChange}},[r("el-table-column",{attrs:{label:"全选",type:"selection"}}),t._v(" "),r("el-table-column",{attrs:{label:"照片",prop:"image",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("img",{staticStyle:{width:"100px",height:"50px"},attrs:{src:t.genDownUrl(e.row.photo)}})]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"姓名",prop:"title",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"岗位",prop:"job_title",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"性别",prop:"gender",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"身份证号",prop:"idnumber",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"工号",prop:"user_name",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"卡片数量",prop:"cardnumber",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"手机号",prop:"mobile",align:"center"}}),t._v(" "),r("el-table-column",{attrs:{label:"最近修改时间",prop:"updated",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(t._s(t.gcomm.v2datestr(e.row.updated))+"\n                    ")])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"操作","min-width":"220px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{size:"small"},on:{click:function(r){t.hairpin(e.$index,e.row)}}},[r("span",[t._v("发卡\n                        ")])]),t._v(" "),r("el-button",{attrs:{size:"small"},on:{click:function(r){t.handleUserEdit(e.$index,e.row)}}},[r("span",[t._v("修改\n                        ")])]),t._v(" "),r("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(r){t.handleUserDel(e.$index,e.row)}}},[r("span",[t._v("删除\n                        ")])])]}}])})],1),t._v(" "),r("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[r("el-pagination",{attrs:{total:t.userTotalRec,"page-count":t.userTotalPage,layout:"total, sizes, prev, pager, next"},on:{"size-change":t.userSizeChange,"current-change":t.userCurChange}})],1)],1),t._v(" "),r("el-dialog",{attrs:{visible:t.showEditOrgSet,title:"部门编辑","append-to-body":!0,"destroy-on-close":!0},on:{"update:visible":function(e){t.showEditOrgSet=e}}},[t.showEditOrgSet?r("orgedit",{attrs:{paramsObj:t.orgInstEdit},on:{submitOk:t.editOrgSetOK,submitClose:function(e){t.showEditOrgSet=!1}}}):t._e()],1),t._v(" "),t.show?r("el-dialog",{attrs:{visible:t.show,title:"发卡","append-to-body":!0,"destroy-on-close":!0},on:{"update:visible":function(e){t.show=e},close:t.hairpinclose}},[r("div",{staticStyle:{"padding-left":"60px"}},[r("span",[t._v("卡号：\n            ")]),t._v(" "),r("el-input",{staticStyle:{width:"200px"},model:{value:t.cardno,callback:function(e){t.cardno=e},expression:"cardno"}})],1),t._v(" "),r("div",{staticStyle:{"text-align":"center","margin-top":"10px"}},[r("el-button",{on:{click:t.determine}},[r("span",[t._v("提交\n                ")])])],1)]):t._e()],1)},[],!1,null,"6d23974c",null);p.options.__file="index.vue";e.default=p.exports}}]);