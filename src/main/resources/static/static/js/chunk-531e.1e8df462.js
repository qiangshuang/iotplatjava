(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-531e"],{YAcO:function(t,e,a){"use strict";var s=a("Zzo+");a.n(s).a},"Zzo+":function(t,e,a){},k02v:function(t,e,a){"use strict";a.r(e);var s=a("P2sY"),i=a.n(s),l=a("gDS+"),o=a.n(l),n=a("MQ60"),r=a.n(n),c={name:"userdata",mixins:[a("y2a5").a],components:{Draggable:r.a},data:function(){return{myData:[],setuData:[],showEditUserData:!1,userDataForm:{id:0,user_id:this.$route.params.id,scope_table:"",scope_ids:"",sort:1,memo:"",version:0,cs1:"",cs2:"",op_name:"",cs1_title:"",ids_title:""},scopeidDatas:[],scopeTableDatas:[],dbTableData:[],delIds:[],roleListData:[],importRoleSel:"",importShow:!1,exportRoleSel:"",exportShow:!1}},mounted:function(){var t=this;this.callSrvAct("/dbtableinfo",{_hy:"dbtableinfo",encode:"ipincloud",version:"1.0.0"}).then(function(e){console.log("db table :",e),t.dbTableData=e.data||[]}),this.getUserDataList();this.callSrvAct("/actq",{_hy:"rolelist",qps:[{name:"title",val:"",op:"like"}],rop:1e4,cp:1}).then(function(e){e.data&&e.data.pageData&&(t.roleListData=e.data.pageData||[])})},methods:{getUserDataList:function(){var t=this,e={_hy:"userdatalist",qps:[{name:"user_id",val:this.$route.params.id,op:"="}]};this.callSrvAct("/actq",e).then(function(e){t.setuData=e.data||[],console.log("setuData:",t.setuData,e)})},removItem:function(t,e){var a=e.id;if(a>0){for(var s=!1,i=0;i<this.delIds.length;i++)if(this.delIds[i]==a){s=!0;break}s||this.delIds.push(a)}this.setuData.splice(t,1)},changeDataRange:function(t,e){console.log("v,item:",t,e),"公司"==t?(e.scope_ids=this.$store.state.globaldata.org.id+"",e.ids_title=this.$store.state.globaldata.org.title):"部门"==t&&(e.scope_ids=this.$route.params.parent_id+"",e.ids_title=this.$route.params.parent_title+""),"员工"==t&&(e.scope_ids=this.$route.params.id+"",e.ids_title=this.$route.params.title)},changeColRange:function(t,e){var a=t.colName,s=t.memo;e.cs1_title||(e.cs1_title="");var i=","+e.cs1+",",l=","+e.cs1_title+",";i.indexOf(","+a+",")>-1?(i=i.replace(","+a+",",","),l=l.replace(","+s+",",","),","==i[0]&&(e.cs1=i.slice(1),e.cs1_title=l.slice(1)),i.length>0&&","==i[i.length-1]&&(e.cs1=i.slice(1,i.length-1),e.cs1_title=l.slice(1,l.length-1))):(e.cs1=e.cs1.length>0?e.cs1+","+a:a,e.cs1_title=e.cs1_title.length>0?e.cs1_title+","+s:s)},showSetSel:function(t){return t==this.$route.params.parent_id+""?"部门":t==this.$route.params.id+""?"员工":t==this.$store.state.globaldata.org.id+""?"公司":""},showTableMemo:function(t){for(var e=0;e<this.dbTableData.length;e++)if(t==this.dbTableData[e].name)return this.dbTableData[e].memo||t;return t},showOpnameTitle:function(t){return"read"==t?"读取":"write"==t?"保存":"del"==t?"删除":""},showCs1:function(t){return"read"==t||"write"==t},getCs1CheckDatas:function(t){for(var e=0;e<this.dbTableData.length;e++)if(t==this.dbTableData[e].name)return this.dbTableData[e].cols||[];return[]},handleClose:function(){this.$router.go(-1)},saveUserData:function(){var t=this;this.$confirm("此操作将影响到用户的数据操作范围, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){for(var e=0;e<t.setuData.length;e++)t.setuData[e].scope_ids||(t.setuData[e].scope_ids=t.$route.params.id+"",t.setuData[e].ids_title=t.$route.params.title),t.setuData[e].sort=e+1;var a={_hy:"userdataset",user_data:t.setuData,user_data_ids:t.delIds};t.callSrvAct("/act",a).then(function(e){t.delIds=[],t.getUserDataList(),t.$message.success("数据保存已成功.")})}).catch(function(e){t.$message.error(e)})},handleMoveStart:function(t){},handleMove:function(){return!0},hideEntityTable:function(t){if(!t)return!0;for(var e=0,a=0;a<this.setuData.length;a++)this.setuData[a].scope_table==t&&(e+=1);return 3==e||t.lastIndexOf("_attr")!=t.length-5&&t.indexOf("_")>-1},haveInSetu:function(t){for(var e=0;e<this.setuData.length;e++)if(this.setuData[e].scope_table==t)return!0;return!1},handleMoveEnd:function(t){return!0},handleItemAdd:function(t){var e=t.newIndex,a=JSON.parse(o()(this.setuData[e]));console.log("item:",a,this.setuData.length);for(var s=a.name,i=[],l="",n=0;n<e&&n<this.setuData.length;n++)this.setuData[n].scope_table==s&&(l=l+this.setuData[n].op_name+",");for(var r=e+1;r<this.setuData.length;r++)if(this.setuData[r].scope_table==s){l=l+this.setuData[r].op_name+",";break}l=","+l;for(var c,d=["read","write","del"],h=0;h<d.length;h++)l.indexOf(","+d[h]+",")<0&&i.push({id:0,user_id:this.$route.params.id,scope_table:s,scope_ids:this.$route.params.id+"",sort:e+h,memo:"",cs1:"",cs2:"",version:0,op_name:d[h],cs1_title:"",ids_title:this.$route.params.title});if(!(i.length>0))return this.setuData.splice(e,1),!0;(c=this.setuData).splice.apply(c,[e,1].concat(i))},importRoleData:function(){var t=this;if(this.importRoleSel){var e={_hy:"roledatalist",qps:[{name:"role_id",val:this.importRoleSel,op:"="}]};this.callSrvAct("/actq",e).then(function(e){for(var a=e.data||[],s=0;s<a.length;s++){for(var l=!1,o=0;o<t.setuData.length;o++)if(t.setuData[o].scope_table==a[s].scope_table&&t.setuData[o].op_name==a[s].op_name){l=!0;break}if(!l){var n=i()({},a[s]);n.user_id=t.$route.params.id,n.id=0,delete n.role_id,t.setuData.push(n)}}t.importShow=!1})}},exportRoleData:function(){var t=this;if(this.exportRoleSel){for(var e=[],a=0;a<this.setuData.length;a++){var s=i()({},this.setuData[a]);s.id=0,s.role_id=this.exportRoleSel,delete s.user_id,e.push(s)}var l={_hy:"roledataset",role_data:e,role_id:this.exportRoleSel};console.log("upData:",l),this.callSrvAct("/act",l).then(function(e){t.exportShow=!1,t.$message.success("数据导出已成功.")})}}}},d=(a("YAcO"),a("KHd+")),h=Object(d.a)(c,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"form-header form-header-back"},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"account"}}),a("span",{staticStyle:{height:"24px",display:"inline-block","margin-top":"12px"}},[t._v("用户管理")]),t._v(" "),a("el-button",{staticClass:"header-func",on:{click:t.handleClose}},[a("svg-icon",{attrs:{"icon-class":"close"}}),t._v("返回")],1),t._v(" "),a("el-popover",{attrs:{placement:"bottom",trigger:"click"},model:{value:t.importShow,callback:function(e){t.importShow=e},expression:"importShow"}},[a("el-button",{staticClass:"header-func",attrs:{slot:"reference"},slot:"reference"},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"login"}}),t._v("角色导入")],1),t._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.importRoleSel,callback:function(e){t.importRoleSel=e},expression:"importRoleSel"}},t._l(t.roleListData,function(t){return a("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-top":"10px"},on:{click:t.importRoleData}},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ok"}}),t._v("确定")],1)],1),t._v(" "),a("el-popover",{attrs:{placement:"bottom",trigger:"click"},model:{value:t.exportShow,callback:function(e){t.exportShow=e},expression:"exportShow"}},[a("el-button",{staticClass:"header-func",attrs:{slot:"reference"},slot:"reference"},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"logout"}}),t._v("导出角色")],1),t._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:t.exportRoleSel,callback:function(e){t.exportRoleSel=e},expression:"exportRoleSel"}},t._l(t.roleListData,function(t){return a("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})})),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-top":"10px"},on:{click:t.exportRoleData}},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"ok"}}),t._v("确定")],1)],1),t._v(" "),a("el-button",{staticClass:"header-func",on:{click:t.saveUserData}},[a("svg-icon",{staticClass:"icon",attrs:{"icon-class":"save"}}),t._v("保存")],1)],1),t._v(" "),a("el-main",{staticClass:"db-main"},[a("el-container",{staticStyle:{"overflow-y":"hidden"},attrs:{direction:"horizontal"}},[a("el-aside",{staticStyle:{width:"250px",height:"100%","overflow-y":"hidden","border-right":"1px solid #eee"}},[a("el-scrollbar",{staticClass:"scrollc tblist"},[a("draggable",{attrs:{tag:"ul",list:t.dbTableData,options:{group:{name:"userdata",pull:"clone",put:!1},sort:!1,ghostClass:"ghost"},move:t.handleMove},on:{start:t.handleMoveStart}},t._l(t.dbTableData,function(e,s){return t.hideEntityTable(e.name)?t._e():a("li",{key:s,staticClass:"li_tb"},[a("span",{staticStyle:{"padding-left":"10px",width:"150px"}},[t._v(t._s(e.memo||e.name))])])})),t._v(" "),a("div",{staticStyle:{height:"2px"}})],1),t._v(" "),a("div",{staticStyle:{position:"absolute",height:"15px",bottom:"0px",left:"0px",width:"249px",background:"#fff"}})],1),t._v(" "),a("el-main",{staticStyle:{height:"100%","overflow-y":"hidden",padding:"0px",margin:"0px"}},[a("el-scrollbar",{staticClass:"scrollcode "},[a("draggable",{staticClass:"code-list",attrs:{tag:"ul",options:{group:{name:"userdata"},put:{function:"canPut"},ghostClass:"ghost"}},on:{end:t.handleMoveEnd,add:t.handleItemAdd},model:{value:t.setuData,callback:function(e){t.setuData=e},expression:"setuData"}},t._l(t.setuData,function(e,s){return a("li",{key:s,staticClass:"li_tb"},[a("span",{staticClass:"leftt"},[t._v("数据表单:")]),t._v(" "),a("span",{staticStyle:{"padding-left":"10px","font-size":"14px"}},[t._v(t._s(t.showTableMemo(e.scope_table))+"\n                ")]),t._v(" "),a("span",{staticClass:"leftt"},[t._v("动作名称:")]),t._v(" "),a("span",{staticStyle:{"padding-left":"10px","font-size":"14px"}},[t._v(t._s(t.showOpnameTitle(e.op_name)))]),t._v(" "),a("el-button",{staticStyle:{float:"right","margin-right":"10px"},attrs:{type:"text",size:"small"},on:{click:function(a){t.removItem(s,e)}}},[t._v("移除")]),t._v(" "),a("div",[a("span",{staticClass:"leftt"},[t._v("数据范围:")]),t._v(" "),a("span",{staticStyle:{"padding-left":"10px","font-size":"14px"}},[t._v(t._s(e.ids_title))]),t._v(" "),a("el-popover",{staticStyle:{float:"right","margin-right":"-26px"},attrs:{placement:"right",trigger:"click"}},[a("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t._v("设置")]),t._v(" "),a("el-radio-group",{attrs:{size:"mini",value:t.showSetSel(e.scope_ids)}},[a("el-radio",{staticStyle:{display:"block"},attrs:{label:"公司"},on:{change:function(a){t.changeDataRange("公司",e)}}}),t._v(" "),a("el-radio",{staticStyle:{display:"block"},attrs:{label:"部门"},on:{change:function(a){t.changeDataRange("部门",e)}}}),t._v(" "),a("el-radio",{staticStyle:{display:"block"},attrs:{label:"员工"},on:{change:function(a){t.changeDataRange("员工",e)}}}),t._v(" "),a("el-radio",{staticStyle:{display:"block"},attrs:{label:"自定义"},on:{change:function(a){t.changeDataRange("自定义",e)}}})],1)],1)],1),t._v(" "),t.showCs1(e.op_name)?a("div",[a("span",{staticClass:"leftt"},[t._v("隐藏数列:")]),t._v(" "),a("span",{staticClass:"showtitle"},[t._v(t._s(e.cs1_title))]),t._v(" "),a("el-popover",{staticStyle:{float:"right","margin-right":"10px"},attrs:{placement:"right",trigger:"click"}},[a("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t._v("设置")]),t._v(" "),a("el-checkbox-group",{attrs:{size:"mini",value:e.cs1.split(",")}},t._l(t.getCs1CheckDatas(e.scope_table),function(s,i){return a("el-checkbox",{key:s.colName,staticStyle:{display:"block"},attrs:{label:s.colName},on:{change:function(a){t.changeColRange(s,e)}}},[t._v(t._s(s.memo)+"\n                      ")])}))],1)],1):t._e()],1)})),t._v(" "),a("div",{staticStyle:{height:"2px"}})],1),t._v(" "),a("div",{staticStyle:{position:"absolute",height:"15px",bottom:"0px",left:"251px",right:"0px",background:"#fff"}})],1)],1)],1)],1)},[],!1,null,"0cd901ed",null);h.options.__file="index.vue";e.default=h.exports}}]);